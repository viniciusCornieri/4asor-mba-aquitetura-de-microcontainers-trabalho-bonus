apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-mysql-test"
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: mysql-test
      image: mysql:8.0
      command: ['mysql']
      args:
        - "-h"
        - "{{ .Release.Name }}-mysql"
        - "-u"
        - "{{ .Values.mysql.user }}"
        - "-p$(MYSQL_PASSWORD)"
        - "-e"
        - "SELECT 1;"
      env:
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ .Release.Name }}-mysql-secret
              key: mysql-password
  restartPolicy: Never